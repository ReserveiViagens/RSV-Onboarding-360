# üîê CONFIGURA√á√ÉO DE ACESSO POSTGRESQL - ONION RSV 360
# PostgreSQL Client Authentication Configuration File

# =============================================================================
# CONFIGURA√á√ïES DE AUTENTICA√á√ÉO
# =============================================================================

# TYPE  DATABASE        USER            ADDRESS                 METHOD

# "local" √© para conex√µes Unix domain socket
local   all             postgres                                peer
local   all             all                                     scram-sha-256

# IPv4 local connections:
host    all             postgres        127.0.0.1/32            scram-sha-256
host    all             all             127.0.0.1/32            scram-sha-256

# IPv6 local connections:
host    all             postgres        ::1/128                 scram-sha-256
host    all             all             ::1/128                 scram-sha-256

# =============================================================================
# CONFIGURA√á√ïES PARA MICROSERVI√áOS (DOCKER NETWORK)
# =============================================================================

# Conex√µes da rede Docker (onion-network)
host    all             all             172.16.0.0/12           scram-sha-256
host    all             all             192.168.0.0/16          scram-sha-256
host    all             all             10.0.0.0/8              scram-sha-256

# =============================================================================
# CONFIGURA√á√ïES POR BANCO DE DADOS
# =============================================================================

# Core Services
host    onion_core      core_user       172.16.0.0/12           scram-sha-256
host    onion_travel    travel_user     172.16.0.0/12           scram-sha-256
host    onion_finance   finance_user    172.16.0.0/12           scram-sha-256
host    onion_tickets   tickets_user    172.16.0.0/12           scram-sha-256

# Business Services
host    onion_payments  payments_user   172.16.0.0/12           scram-sha-256
host    onion_ecommerce ecommerce_user  172.16.0.0/12           scram-sha-256
host    onion_vouchers  vouchers_user   172.16.0.0/12           scram-sha-256

# Analytics & Reports
host    onion_analytics analytics_user  172.16.0.0/12           scram-sha-256
host    onion_reports   reports_user    172.16.0.0/12           scram-sha-256

# User Services
host    onion_users     users_user      172.16.0.0/12           scram-sha-256
host    onion_notifications notifications_user 172.16.0.0/12   scram-sha-256

# =============================================================================
# CONFIGURA√á√ïES DE REPLICA√á√ÉO
# =============================================================================

# Replication connections
host    replication     replicator      172.16.0.0/12           scram-sha-256
host    replication     replicator      127.0.0.1/32            scram-sha-256

# =============================================================================
# CONFIGURA√á√ïES DE BACKUP
# =============================================================================

# Backup user
host    all             backup_user     127.0.0.1/32            scram-sha-256
local   all             backup_user                             peer

# =============================================================================
# CONFIGURA√á√ïES DE MONITORAMENTO
# =============================================================================

# Monitoring tools
host    all             monitor_user    172.16.0.0/12           scram-sha-256
host    all             monitor_user    127.0.0.1/32            scram-sha-256

# =============================================================================
# CONFIGURA√á√ïES DE DESENVOLVIMENTO (APENAS EM DEV)
# =============================================================================

# Para desenvolvimento local (comentar em produ√ß√£o)
host    all             dev_user        0.0.0.0/0               md5

# =============================================================================
# CONFIGURA√á√ïES DE PRODU√á√ÉO (SSL OBRIGAT√ìRIO)
# =============================================================================

# Para produ√ß√£o, descomente estas linhas e comente as de desenvolvimento:
# hostssl all             all             0.0.0.0/0               scram-sha-256
# hostnossl all           all             0.0.0.0/0               reject

# =============================================================================
# NOTAS DE SEGURAN√áA
# =============================================================================

# 1. Em produ√ß√£o, sempre use SSL (hostssl)
# 2. Prefira scram-sha-256 ao inv√©s de md5
# 3. Seja espec√≠fico com ranges de IP
# 4. Use usu√°rios espec√≠ficos por servi√ßo
# 5. Monitore tentativas de conex√£o falhadas